{
  "feature": "Transactions Tab with Stats",
  "version": "1.0",
  "created": "2026-01-09",
  "goal": "Users can visualize spending distribution and browse transaction history by period",
  "spec": {
    "overview": "The Transactions tab provides a visual spending breakdown and chronological transaction history. It combines statistics visualization with a browsable transaction list to help users understand their spending patterns.\n\nPrimary use cases:\n- Visualize spending distribution across funds\n- Browse recent spending history by period\n- Identify top spending categories at a glance",
    "layout": "```\n+------------------------------------------+\n|  Transactions                             |  <- Standard header\n+------------------------------------------+\n|  [Week] [Month*] [3 mo] [All]            |  <- Period chips\n+------------------------------------------+\n|                                          |\n|  [  Pie Chart  ]  Total Spent            |  <- Stats header\n|  [   (60%)     ]  ₱XX,XXX                |     (scrolls away)\n|                   ─────────              |\n|                   Top Funds              |\n|                   1. Food      ₱X,XXX    |\n|                   2. Bills     ₱X,XXX    |\n|                   3. Transport ₱X,XXX    |\n|                                          |\n+------------------------------------------+\n|  Today                          ₱X,XXX   |  <- Date header\n|  ├─ Store Name               ₱XXX.XX    |\n|  ├─ Store Name               ₱XXX.XX    |\n|  └─ Fund Name                ₱XXX.XX    |\n|                                          |\n|  Yesterday                      ₱X,XXX   |\n|  ├─ ...                                  |\n|                                          |\n|  [ Load More ]                           |  <- Pagination\n+------------------------------------------+\n```",
    "design": {
      "periodChips": {
        "layout": "Fixed horizontal row, 4 chips",
        "options": ["Week (last 7 days)", "Month (current calendar, default)", "3 mo (last 3 months)", "All (no filter)"],
        "behavior": "Single selection, changing period resets list. Active: filled bg, inactive: outline only."
      },
      "donutChart": {
        "tech": "d3-shape + react-native-svg + react-native-reanimated",
        "style": {
          "innerRadius": "50%",
          "cornerRadius": 12,
          "padAngle": 0.04,
          "colors": "Monochromatic violet (6 shades, darkest to lightest)"
        },
        "slices": "Top 5 funds individually, rest grouped as 'Other'",
        "interaction": {
          "gesture": "Tap only",
          "focusEffect": "Radial pop-out 8-10px + dim others to 30% + soft drop shadow",
          "animation": "Spring (damping: 15, stiffness: 150)",
          "haptics": "Light impact on tap"
        },
        "centerLabel": {
          "default": "Top fund name (text-xs) + amount (text-sm, font-nunito-bold)",
          "focused": "Percentage (text-2xl, font-nunito-bold) + fund name (text-xs)",
          "transition": "Crossfade ~200ms"
        }
      },
      "statsPanel": {
        "layout": "60/40 split (chart/stats)",
        "content": "Total spent (large) + top 3 funds with amounts",
        "tiebreaker": "Alphabetical by fund name"
      },
      "transactionList": {
        "component": "SectionList grouped by date",
        "sectionHeader": "'Today', 'Yesterday', or 'Mon, Jan 6' + daily total",
        "row": "Store name (fallback: fund name) + amount. Read-only in V1.",
        "pagination": "50 per page, Load More button at bottom"
      },
      "emptyStates": {
        "newUser": "Hide stats header, show educational message + CTA to Add Expense",
        "periodEmpty": "Show zeroed chart, period-specific message in list area"
      },
      "loading": "Skeleton for stats header, spinner for list. Stale-while-revalidate caching."
    },
    "api": {
      "stats": {
        "input": "{ period: 'week' | 'month' | '3mo' | 'all' }",
        "output": "{ totalSpent: number, byFund: Array<{ fundId, fundName, amount, percentage }> }"
      },
      "list": {
        "input": "{ period, cursor?, limit? }",
        "output": "{ transactions: Array<{ id, amount, date, note?, fund: { name }, store?: { name } }>, nextCursor? }"
      }
    },
    "files": [
      { "action": "modify", "path": "apps/mobile/src/app/(app)/(tabs)/transactions.tsx", "purpose": "Main tab screen" },
      { "action": "create", "path": "apps/mobile/src/components/stats/pie-chart-segmented.tsx", "purpose": "Interactive donut chart" },
      { "action": "create", "path": "apps/mobile/src/components/stats/stats-header.tsx", "purpose": "Stats header layout" },
      { "action": "create", "path": "apps/mobile/src/components/stats/period-chips.tsx", "purpose": "Period filter chips" },
      { "action": "create", "path": "apps/mobile/src/lib/chart-colors.ts", "purpose": "Chart color palette" },
      { "action": "modify", "path": "apps/mobile/src/components/transactions/transaction-list.tsx", "purpose": "Add pagination" },
      { "action": "modify", "path": "packages/api/src/router/transactions.ts", "purpose": "Add stats + list endpoints" }
    ],
    "implementationOrder": [
      "API layer (transaction.stats and transaction.list endpoints)",
      "Period chips (filter component with state)",
      "Donut chart (d3-shape + react-native-svg + reanimated)",
      "Stats header (layout with chart + quick stats)",
      "Transaction list (pagination with load more)",
      "Tab assembly (wire everything together)",
      "Empty states (handle zero transactions)",
      "Polish (loading states, caching, edge cases)"
    ],
    "deferred": ["Search", "Store grouping toggle", "Transaction detail sheet", "Edit/Delete transactions", "Spending trends", "Privacy toggle"]
  },
  "items": [
    {
      "id": "TXN-001",
      "category": "API",
      "description": "transaction.stats endpoint returns spending aggregates by fund for selected period",
      "steps_to_verify": [
        "Call transaction.stats with period='month' returns totalSpent as number",
        "byFund array contains fundId, fundName, amount, percentage for each fund",
        "Percentages sum to 100 (within rounding tolerance)",
        "Results sorted by amount descending",
        "period='week' returns last 7 days data",
        "period='3mo' returns last 3 calendar months",
        "period='all' returns all-time data"
      ],
      "passes": false
    },
    {
      "id": "TXN-002",
      "category": "API",
      "description": "transaction.list endpoint returns paginated transactions for selected period",
      "steps_to_verify": [
        "Returns transactions array with id, amount, date, note, fund.name, store.name",
        "Accepts cursor param for pagination",
        "Default limit is 50, respects custom limit",
        "Returns nextCursor when more pages exist",
        "Returns null/undefined nextCursor on last page",
        "Transactions sorted by date descending",
        "Period filter constrains results correctly"
      ],
      "passes": false
    },
    {
      "id": "TXN-003",
      "category": "UI Component",
      "description": "Period filter chips allow single-selection between Week/Month/3mo/All",
      "steps_to_verify": [
        "4 chips displayed horizontally: Week, Month, 3 mo, All",
        "Month selected by default on mount",
        "Only one chip can be active at a time",
        "Active chip has filled background, inactive has outline",
        "Tapping chip triggers onChange callback with period value",
        "No amounts shown on chips"
      ],
      "passes": false
    },
    {
      "id": "TXN-004",
      "category": "UI Component",
      "description": "Donut chart displays spending distribution by fund with interactive slice focus",
      "steps_to_verify": [
        "Donut chart renders using d3-shape + react-native-svg + reanimated",
        "Slices have heavily rounded (pill-shaped) corners",
        "Visible gaps between slices (~2-3px angular gap)",
        "Shows max 5 individual fund slices, rest grouped as 'Other'",
        "Uses monochromatic accent color palette (6 shades)",
        "Tap slice triggers focus effect: radial pop-out + dim others to 30% + soft drop shadow",
        "Focus transitions use spring animation (damping: 15, stiffness: 150)",
        "Center label shows percentage + fund name when slice focused",
        "Center label crossfades (~200ms) between states",
        "Tap same slice again to unfocus (return to default)",
        "Haptic feedback (light impact) on tap",
        "Slices stay in fixed positions (no rotation)"
      ],
      "passes": false
    },
    {
      "id": "TXN-005",
      "category": "UI Component",
      "description": "Stats header displays pie chart (60%) and quick stats panel (40%)",
      "steps_to_verify": [
        "Layout is side-by-side with 60/40 split",
        "Left side contains pie chart",
        "Right side shows total spent amount (large, bold)",
        "Right side shows top 3 funds with amounts",
        "If <3 funds have spending, shows only those that exist",
        "Equal amounts use alphabetical fund name as tiebreaker",
        "Header scrolls away with content (not sticky)"
      ],
      "passes": false
    },
    {
      "id": "TXN-006",
      "category": "UI Component",
      "description": "Transaction list shows date-grouped transactions with daily totals",
      "steps_to_verify": [
        "Transactions grouped by date in SectionList",
        "Section headers show 'Today', 'Yesterday', or formatted date",
        "Daily total displayed on right side of section header",
        "Transaction row shows store name (or fund name fallback)",
        "Transaction row shows formatted amount on right",
        "Rows have no tap action (read-only)"
      ],
      "passes": false
    },
    {
      "id": "TXN-007",
      "category": "UI Component",
      "description": "Load More button handles pagination",
      "steps_to_verify": [
        "Load More button appears at bottom of list when nextCursor exists",
        "Tapping button fetches next page",
        "Button shows loading state while fetching",
        "New transactions append to existing list",
        "Button hidden when no more pages (nextCursor null)"
      ],
      "passes": false
    },
    {
      "id": "TXN-008",
      "category": "UI State",
      "description": "Empty state for new users (zero transactions ever)",
      "steps_to_verify": [
        "Stats header hidden entirely",
        "Educational message displayed with icon",
        "CTA button 'Go to Add Expense' visible",
        "CTA navigates to Add Expense tab"
      ],
      "passes": false
    },
    {
      "id": "TXN-009",
      "category": "UI State",
      "description": "Empty state for period with no transactions",
      "steps_to_verify": [
        "Stats header shows with zeroed/empty chart",
        "Total displays as 0",
        "Period-specific message in list area (e.g., 'No spending this week')",
        "Suggestion to try different period shown"
      ],
      "passes": false
    },
    {
      "id": "TXN-010",
      "category": "UI State",
      "description": "Loading states use skeleton placeholders and optimistic caching",
      "steps_to_verify": [
        "Initial load shows skeleton for stats header",
        "Initial load shows spinner in list area",
        "Cached data shown immediately on tab refocus",
        "Fresh data fetched in background",
        "UI updates when new data arrives"
      ],
      "passes": false
    },
    {
      "id": "TXN-011",
      "category": "Integration",
      "description": "Period changes reset list and refetch all data",
      "steps_to_verify": [
        "Changing period clears current transaction list",
        "Stats refetched with new period",
        "Transaction list refetched with new period",
        "Pagination resets (cursor cleared)",
        "No chart animation (instant swap)"
      ],
      "passes": false
    },
    {
      "id": "TXN-012",
      "category": "Integration",
      "description": "Full tab assembly with header, chips, stats, and list",
      "steps_to_verify": [
        "Tab has standard header with 'Transactions' title",
        "Period chips below header",
        "Stats header below chips",
        "Transaction list fills remaining space",
        "All components respond to period selection",
        "Tab accessible from bottom navigation"
      ],
      "passes": false
    },
    {
      "id": "TXN-013",
      "category": "Styling",
      "description": "Chart colors use configurable monochromatic accent palette",
      "steps_to_verify": [
        "chart-colors.ts exports 6 shades derived from accent",
        "Shades range from lightest to darkest",
        "Colors used consistently across pie slices",
        "Easy to change base color via single constant"
      ],
      "passes": false
    }
  ]
}
