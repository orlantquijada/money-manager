{
  "feature": "Non-Negotiable Progress Bars",
  "version": "1.0",
  "created": "2026-01-10",
  "goal": "Non-negotiable funds show savings progress (0→100%) instead of spending depletion (100%→0%)",
  "spec": {
    "overview": "Non-negotiable funds (rent, utilities, subscriptions) have a different mental model than spending funds. Users save toward a target amount that's due on a specific date. Progress should reflect 'How much have I saved toward this bill?' not 'How much can I still spend?'\n\n**Key Difference:**\n- Spending: Budget depletes as you spend → bar goes from full to empty\n- Non-negotiable: Savings accumulate toward target → bar goes from empty to full",
    "design": "### Visual Behavior\n\n```\nSpending Fund (current behavior):\n[████████░░] 80% remaining → [░░░░░░░░░░] 0% (overspent)\n\nNon-Negotiable Fund (new behavior):\n[██░░░░░░░░] 20% saved → [██████████] 100% (fully funded)\n```\n\n### Progress Calculation\n\n| Fund Type | Formula | Display |\n|-----------|---------|----------|\n| SPENDING | `amountLeft / budget` | 'X left' |\n| NON_NEGOTIABLE | `saved / budgetedAmount` | 'X / Y saved' |\n\n### Color Logic\n\n**Spending (current):**\n- Green: >30% remaining\n- Amber: 10-30% remaining  \n- Red: <10% remaining\n\n**Non-Negotiable (proposed):**\n- Muted: <50% saved\n- Lime/success: 50-99% saved\n- Green + checkmark: 100% funded\n\n### States\n\n1. **Empty** (0%): Just created, no savings yet\n2. **In Progress** (1-99%): Partially funded\n3. **Funded** (100%): Ready to pay\n4. **Overfunded** (>100%): Extra buffer (cap visual at 100%, show actual amount)\n\n### Interaction\n\n- Tapping fund row navigates to fund detail\n- Fund detail shows: due date, amount saved, amount remaining\n- When funded, show 'Mark as Paid' action to reset for next period",
    "api": "### fundWithMeta Extension\n\n```typescript\ntype FundMeta = {\n  // Existing\n  amountLeft: number;\n  progress: number; // 0-1, spending depletion\n  \n  // New for NON_NEGOTIABLE\n  amountSaved?: number;\n  savingsProgress?: number; // 0-1, savings accumulation\n  isFunded?: boolean; // savingsProgress >= 1\n};\n```\n\n### Progress Calculation\n\n```typescript\nfunction getFundProgress(fund: Fund) {\n  if (fund.type === 'NON_NEGOTIABLE') {\n    // Savings accumulation: empty → full\n    const saved = fund.budgetedAmount - fund.amountLeft;\n    return {\n      progress: saved / fund.budgetedAmount,\n      amountSaved: saved,\n      isFunded: saved >= fund.budgetedAmount\n    };\n  }\n  \n  // Spending depletion: full → empty (unchanged)\n  return {\n    progress: fund.amountLeft / fund.budgetedAmount\n  };\n}\n```",
    "files": [
      { "action": "modify", "path": "apps/mobile/src/lib/fund.ts", "purpose": "Add savingsProgress calculation for NON_NEGOTIABLE funds" },
      { "action": "modify", "path": "apps/mobile/src/components/add-expense/fund-picker-sheet.tsx", "purpose": "Render progress bar based on fund type (invert for non-negotiable)" },
      { "action": "modify", "path": "apps/mobile/src/components/dashboard/fund-row.tsx", "purpose": "Show savings progress for non-negotiable funds" }
    ]
  },
  "items": [
    {
      "id": "NNP-001",
      "category": "Data",
      "description": "Extend fundWithMeta to calculate savingsProgress for NON_NEGOTIABLE funds",
      "steps_to_verify": [
        "fundWithMeta returns savingsProgress (0-1) for NON_NEGOTIABLE funds",
        "savingsProgress = (budgetedAmount - amountLeft) / budgetedAmount",
        "isFunded flag is true when savingsProgress >= 1"
      ],
      "passes": false
    },
    {
      "id": "NNP-002",
      "category": "UI Component",
      "description": "Fund picker sheet shows inverted progress bar for non-negotiable funds",
      "steps_to_verify": [
        "Progress bar fills from left (0%) to right (100%) as user saves",
        "Color reflects savings status (muted → lime → green)",
        "Amount display shows 'X / Y' format instead of 'X left'"
      ],
      "passes": false
    },
    {
      "id": "NNP-003",
      "category": "UI Component",
      "description": "Dashboard fund row shows savings progress for non-negotiable funds",
      "steps_to_verify": [
        "Non-negotiable funds show progress bar filling up toward target",
        "100% funded state shows visual success indicator",
        "Overfunded (>100%) caps bar at full, shows actual amount"
      ],
      "passes": false
    },
    {
      "id": "NNP-004",
      "category": "UX Polish",
      "description": "Funded state celebration and reset flow",
      "steps_to_verify": [
        "When fund reaches 100%, show subtle success animation",
        "Fund detail shows 'Mark as Paid' action when funded",
        "Marking as paid resets progress for next period"
      ],
      "passes": false
    }
  ]
}
